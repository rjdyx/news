function getMainNavs(){$.ajax({type:"GET",url:$.GetUrl()+"NavAction/getMainNavs",dataType:"json",contentType:"application/json",success:function(e){var t="";t+='<select class="form-control" onchange="getSubNavs()">',t+='<option value="-2">最新消息</option>',t+='<option value="-3">通知公告</option>',t+='<option value="-4">图片新闻</option>',t+='<option value="-5">常用管理系统</option>';for(var o=2;o<e.length;o++)t+='<option value="'+e[o].priority+'">'+e[o].name+"</option>";t+="</select>",$("#main-nav").append(t),getSubNavs()},error:function(){toastr.error("连接失败")}})}function getSubNavs(){var e=$("#main-nav select option:selected").val();if($("#sub-nav select").remove(),-2>=e){var t="";return t+='<select class="form-control"><option value="'+e+'">无子栏目</option></select>',$("#sub-nav").append(t),!1}$.ajax({type:"GET",url:$.GetUrl()+"NavAction/getSubNavs",data:{parent:e},dataType:"json",success:function(e){var t="";t+='<select class="form-control">';for(var o=0;o<e.length;o++)t+='<option value="'+e[o].priority+'">'+e[o].name+"</option>";0==e.length&&(t+='<option value="0" selected="selected">无子栏目</option>'),t+="</select>",$("#sub-nav").append(t)},error:function(){toastr.error("连接失败")}})}function submitNews(){var e=$("#main-nav select option:selected").val();-4==e?($("#edit-modal").modal("show",{backdrop:"static"}),choosePic()):addNewsWithoutPic()}function addNews(){$.ajax({type:"POST",url:$.GetUrl()+"NewsAction/addNews",data:{title:$("#article_name").val(),content:UE.getEditor("editor").getContent(),pic:$("input:checkbox[name=flag]:checked").parent().siblings()[0].outerHTML,parent:$("#main-nav select option:selected").val(),priority:$("#sub-nav select option:selected").val(),time:$("#article_date").val()},dataType:"json",success:function(e){"1"==e&&(toastr.success("发布成功"),setTimeout(function(){window.location.reload()},800))},error:function(){toastr.error("连接失败")}})}function addNewsWithoutPic(){$.ajax({type:"POST",url:$.GetUrl()+"NewsAction/addNews",data:{title:$("#article_name").val(),content:UE.getEditor("editor").getContent(),parent:$("#main-nav select option:selected").val(),priority:$("#sub-nav select option:selected").val(),time:$("#article_date").val()},dataType:"json",success:function(e){"1"==e&&(toastr.success("发布成功"),setTimeout(function(){window.location.reload()},800))},error:function(){toastr.error("连接失败")}})}function choosePic(){for(var e=UE.getEditor("editor").getContent(),t=new Array,o=0;;){e=e.substring(e.indexOf("<img"));var n=e.substring(0,e.indexOf("/>")+2);if(n.indexOf("width")>0,t[o++]=n,e=e.substring(e.indexOf("/>")+2),-1==e.indexOf("<img"))break}for(var a="",i=0;i<t.length;i++)a+='<div class="col-md-3 col-sm-4 col-xs-6">	 <div class="album-image">',a+=t[i],a+='	 <div class="image-checkbox">		     <input type="checkbox" name="flag" />	     </div>    </div>   </div>';$("#news-pic").children().remove(),$("#news-pic").append(a),$(":checkbox[name=flag]").each(function(){$(this).click(function(){$(this).prop("checked")&&($(":checkbox[name=flag]").removeProp("checked"),$(this).prop("checked","checked"),$("#submitPicNews").removeClass("disabled")),$(this).prop("checked")||$("#submitPicNews").addClass("disabled")})})}function checkTitle(){""==$("#article_name").val()?$("#submitBtn").addClass("disabled"):$("#submitBtn").removeClass("disabled")}$(function(){getMainNavs()}),jQuery.GetUrl=function(){var e=window.location.pathname.split("/");return"static"==e[1]||e[1].indexOf("Action")>0?"/":"/"+e[1]+"/"};
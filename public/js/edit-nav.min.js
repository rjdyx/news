function getNavs(){$.ajax({type:"GET",url:$.GetUrl()+"NavAction/getNavsToBackStage",dataType:"json",contentType:"application/json",success:function(a){for(var e="",n=2;n<a.length;n++){if(e+='<div class="col-sm-4">  <div class="panel panel-default panel-border panel-shadow">    <div class="panel-heading">      <h3 class="panel-title" id="'+a[n][0].id+"_"+a[n][0].model+'">'+a[n][0].name+'</h3>      <div class="panel-options">          <i class="linecons-pencil"></i>          <i class="linecons-trash"></i>      </div>    </div>    <div class="panel-body">      <ul>',a[n].length>1)for(var t=1;t<a[n].length;t++)e+='<li id="'+a[n][t].id+"_"+a[n][t].model+'">'+a[n][t].name+"</li>";e+="</ul>    </div>  </div></div>"}$(".edit-nav").append(e),init()},error:function(){toastr.error("连接失败")}})}function init(){var a=$("#main_nav_name"),e=$("#sub_nav_name"),n=$(".subNavList ul");$(".panel .linecons-pencil").click(function(){var n=$(this).parents(".panel-heading"),t=n.children(".panel-title").text(),i=n.siblings(".panel-body").children("ul").children(),s=n.children(".panel-title").attr("id").split("_"),l=s[0];$("#edit-modal").modal("show",{backdrop:"static"}),a.val(t),a.siblings("span").remove();var c='<span class="input-group-btn iswitch-box">   <input type="checkbox"  id="iswitch" '+(1==s[1]?' checked="checked" ':"")+" onclick=\"changeNavModel('"+s[0]+"',"+s[1]+')" /><label for="iswitch"></label></span>';a.after(c),$(".input-group").attr("id",l),e.attr("id",l);for(var o=0;o<i.length;o++){var r=i[o].id.split("_"),d=$('<li class="m-label" id="'+r[0]+'"><span>'+$(i[o]).text()+'</span><input type="text" /><i class="fa-check" ></i><input type="checkbox" id="subnav-'+o+'" '+(1==r[1]?' checked="checked" ':"")+" onclick=\"changeNavModel('"+r[0]+"',"+r[1]+')" /><label class="f-r" for="subnav-'+o+'"></label><i class="linecons-trash f-r"></i><i class="linecons-pencil f-r"></i ></li>');$("#edit-modal  ul").append(d)}$(".subNavList .linecons-trash").click(function(a){var e=$(this).parent();deleteSubNav($(this).parent().attr("id"),e)})}),$(".panel .linecons-trash").click(function(){$("#delete-nav").modal("show",{backdrop:"fade"});var a=$(this).parents(".panel-heading").children(".panel-title").attr("id");$("#delete-nav strong").attr("id",a)}),$("#add_btn").click(function(a){var n=e.val(),t=$(this).parent().siblings().attr("id");addSubNav(t,n,e)}),$("#edit-modal").delegate(".subNavList .linecons-pencil","click",function(a){var e=$(this).siblings(".fa-check"),n=$(this).siblings('input[type="text"]'),t=$(this).siblings("label"),i=$(this).siblings("span");$(this).siblings('.fa-check, input[type="text"]').css({display:"inline"}),n.val(i.text()),i.text(""),$(this).siblings(".linecons-trash").css({display:"none"}),$(this).css({display:"none"}),t.css({display:"none"}),e.click(function(a){$(this).siblings(".linecons-pencil,.linecons-trash,span,label").css({display:"inline"}),$(this).siblings("span").text($(this).siblings("input").val()),n.css({display:"none"}),$(this).css({display:"none"});var e=$(this).parent().attr("id"),t=$(this).siblings("input").val();modifySubNav(e,t)})}),$("#edit-modal").on("hidden.bs.modal",function(a){$("#edit-modal ul").empty()}),$("#edit-modal").delegate("#subAjax","click",function(e){var t=a.val(),i=[];$.each(n.children(".m-label"),function(a,e){i.push($(e).children("span").text())}),console.log(i);var s=$(this).parent().siblings().find(".input-group").attr("id");modifyNav(s,t)}),dragNav()}function addSubNav(a,e,n){$.ajax({type:"GET",url:$.GetUrl()+"NavAction/addSubNav",data:{navId:a,subNavName:e},dataType:"json",success:function(a){var t=$(".subNavList ul li").length,i=$('<li class="m-label" id="'+a+'"><span>'+e+'</span><input type="text" /><i class="fa-check" ></i> <input type="checkbox" id="subnav-'+t+'" onclick="changeNavModel(\''+a+'\',0)"/><label class="f-r" for="subnav-'+t+'"></label><i class="linecons-trash f-r"></i><i class="linecons-pencil f-r"></i ></li>');n.val(""),t+=1,$(".subNavList ul").append(i),$(".subNavList .linecons-trash").click(function(a){var e=$(this).parent();deleteSubNav($(this).parent().attr("id"),e)})},error:function(){toastr.error("连接失败")}})}function deleteNav(){var a=$("#delete-nav strong").attr("id");$.ajax({type:"GET",url:$.GetUrl()+"NavAction/deleteNav",data:{navId:a.split("_")[0]},dataType:"json",success:function(e){$("#"+a).parents(".col-sm-4").remove()},error:function(){toastr.error("连接失败")}})}function deleteSubNav(a,e){$.ajax({type:"GET",url:$.GetUrl()+"NavAction/deleteSubNav",data:{navSubId:a},dataType:"json",success:function(a){e.remove()},error:function(){toastr.error("连接失败")}})}function modifyNav(a,e){$.ajax({type:"GET",url:$.GetUrl()+"NavAction/modifyNav",data:{navId:a,newNavName:e},dataType:"json",success:function(a){"1"==a&&(toastr.success("修改成功"),setTimeout(function(){window.location.reload()},800))},error:function(){toastr.error("连接失败")}})}function modifySubNav(a,e){$.ajax({type:"GET",url:$.GetUrl()+"NavAction/modifyNav",data:{navId:a,newNavName:e},dataType:"json",success:function(a){},error:function(){toastr.error("连接失败")}})}function dragNav(){var a=$(".edit-nav").height();$(".edit-nav").sortable({appendTo:"parent",forceHelperSize:!0,forcePlaceholderSize:!0,helper:"clone",delay:150,cursor:"move",revert:!0,scroll:!0,scrollSensitivity:10,tolerance:"pointer",containment:"parent",activate:function(e,n){$(".save-order").css({display:"inline-block"}),$(".edit-nav").height(a)}})}function saveSequence(){var a=new Array;$(".panel-title").each(function(e){a[e]=$(this).attr("id").split("_")[0]}),$.ajax({type:"POST",url:$.GetUrl()+"NavAction/saveSequence",data:{navs:JSON.stringify(a)},dataType:"json",success:function(a){"1"==a&&toastr.success("修改成功")},error:function(){toastr.error("连接失败")}})}function changeNavModel(a,e){$.ajax({type:"GET",url:$.GetUrl()+"NavAction/changeNavModel",data:{id:a,model:1==e?0:1},dataType:"json",success:function(n){$("#"+a+"_"+e).attr("id",a+"_"+(1==e?0:1)),"undefined"==typeof $("#"+a).children("input[type=checkbox]").attr("id")?$("#iswitch").attr("onclick","changeNavModel('"+a+"', "+(1==e?0:1)+")"):$("#"+a).children("input[type=checkbox]").attr("onclick","changeNavModel('"+a+"', "+(1==e?0:1)+")")},error:function(){toastr.error("连接失败")}})}function checkName(){""==$("#main_nav_name").val()?$("#subAjax").addClass("disabled"):$("#subAjax").removeClass("disabled")}function checkSubName(){""==$(".sub_nav_name").val()?$("#add_btn").addClass("disabled"):$("#add_btn").removeClass("disabled")}jQuery.GetUrl=function(){var a=window.location.pathname.split("/");return"static"==a[1]||a[1].indexOf("Action")>0?"/":"/"+a[1]+"/"},$(document).ready(function(){getNavs()});